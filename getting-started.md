# Начало работы

## Пример 1

Цель - создать простую запуск-программу, научиться ее запускать, познакомиться с терминами.

1. Установите zapusk-tool согласно [инструкции](https://github.com/pavelvasev/zapusk-tool).
> Zapusk-tool это инструмент интерпретации zapusk-программ.

2. Создайте каталог с именем `test1.zdb`
> Все zapusk-программы записываются в каталогах с расширением `.zdb`.

3. Создайте в этом каталоге файл `main.ini` следующего содержания:
```
####### params
alfa=5
beta=7

####### block1
[os]
apply=echo "creating alfa {{alfa}}"
destroy=echo "destroying alfa {{alfa}}"

####### block2
[os]
apply=echo "creating beta {{beta}}"
work=echo "working beta {{beta}}"
```
> Таким образом, Вы создали первую запуск-программу.
> Данная запуск-программа содержит блок параметров и два исполнительных блока.

> Каждый исполнительный блок описывает перечень команд, на которые
> он реагирует, и как именно реагирует.
> В данном случае это вызов шелл-команд операционной системы.
> Команды **apply** и **destroy** это стандартные имена команд Zapusk.
> Команда **work** это творчество примера.

4. Также создайте в этом же каталоге файл `zapusk.conf` содержанием:
```
state_dir=_state
```
> zapusk.conf это файл конфигурации для zapusk-tool. В данном случае записана настройка,
> где хранить состояние запуск-программы. У программ есть состояние, чтобы понимать
> какие блоки развернуты, а какие еще нет. Это позволяет автоматически
> выполнять destroy-команду для блоков, которые развернуты а затем удалены.

5. Находясь в каталоге, выполните команду: `zapusk apply`. Вы увидите результат:
```
creating alfa 5
creating beta 7
```
> Алгоритм zapusk-tool прошелся по блокам и вызвал `apply` у каждого блока.

> Формат вызова zapusk: `zapusk имякоманды`
> Была вызвана `zapusk apply`, сообразно имя команды это apply.
> Другие параметры командной строки приведены на странице zapusk-tool.

6. Теперь выполните `zapusk work`. Вы увидите:
```
working beta 7
```
> Алгоритм прошелся по блокам и вызвал `work` у каждого блока.
> Поскольку у block1 команды work не указано, он ничего и не сделал.

7. Выполните `zapusk destroy`. Результат:
```
destroying alfa 5
```
> Команда destroy была передана всем блокам. Она определена только
> в блоке block1, поэтому там и сработала.

## Пример 2

Цель - использовать запуск-программу из примера 1 в качестве блока в другой программе.

1. Создайте каталог `test2.zdb`
> Это будет каталог для новой программы.

2. Создайте в нем файл `zapusk.conf` аналогично как в примере 1.

3. Скопируйте внутрь этого каталога созданный в примере каталог `test1.zdb`
> Мы будем использовать test1.zdb в нашей новой программе. Сообразно он должен быть
> доступен. Самый простой способ сделать доступным это разместить как под-каталог.
> Другой вариант - скопировать в папку zapusk-tool/lib.

4. Создайте файл `myfile.ini` следующего содержания:
```
######## zero
[test1]
beta=0

######## a
[test1]

######## b
[test1]
alfa=vinni
beta=puh
```
> Создана новая запуск-программа. Она использует первую в качестве типа блока.
> На это указывают скобки `[test1]`.

5. Выполните команду `zapusk apply`. Результат:
```
creating alfa 5
creating beta 0
creating alfa 5
creating beta 7
creating alfa vinni
creating beta puh
```
> Все блоки выполнили команду apply

6. Выполните команду `zapusk work`. Результат:
```
working 0
working 7
working puh
```
> Все блоки выполнили команду work

7. Удалите блок `##### a` и его содержимое, оставив в файле `myfile.ini` только строчки:
```
######## zero
[test1]
beta=0

######## b
[test1]
alfa=vinni
beta=puh
```
> В настройке серверов часто возникает желание что-нибудь убрать.

8. Выполните `zapusk work`. Результат:
```
destroying alfa 5
working 0
working puh
```
>
> zapusk-tool отследил, что блок **a** удален, и вызвал метод destroy у его типа с его параметрами,
> которые сохраняются в каталоге состояния. destroy вызывается однократно.

9. Выполните `zapusk work` повторно. Результат:
```
working 0
working puh
```
> Все блоки (оставшиеся) выполнили команду work.

10. Добавьте в файл строки, как указано ниже:
```
######## zero
[test1]
beta=0

######## b
[test1]
alfa=vinni
beta=puh

######## c
[os]
work=echo working good
```
Результат выполнения `zapusk work`:
```
working 0
working puh
working good
```

11. Выполните `zapusk destroy`. Результат:
```
destroying alfa 5
destroying alfa vinni
```

12. Выполните команду `zapusk destroy` еще раз. Результат - пустой, потому что все развернутые блоки уже выполняли destroy и свернуты.

## Другие примеры

Приводятся в каталоге [examples](examples)

## Дополнительно

Можно:
* Создавать свои zdb-блоки и использовать в своих zdb-программах.
* Ознакомиться со [спецификацей zapusk](spec-1.md).
* Использовать [блоки ЛайнАкт](https://github.com/pavelvasev/zapusk-lact-libs).

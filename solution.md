Решение [постановки задачи](task.md).

Запуск-программа
================
Запуск-программа это программа, предназначенная для того, чтобы привести машину (машины) в некоторое требуемое состояние.
В широком смысле цель запуск-программы - производить реакцию на те или иные команды, поступающие к ней.
Одной из реакций может быть настройка машины, но возможны и другие по смыслу реакции.

Программа реагирует на различные команды, включая стандартные: 
`apply` (достичь цели) и `destroy` (отменить внесенные изменения).

Программа состоит из следующих частей:

1. Перечень собственных параметров. Эти параметры могут изменяться извне, вызывающими программу.
Изменяться - значить менять значения и расширять сам список параметров.
2. Набор компонент. Каждый компонент имеет уникальный идентификатор, порядок компонент важен.
3. Каждый компонент содержит набор шагов. Каждый шаг имеет набор параметров, включая идентификатор и тип шага. 
Порядок шагов важен.

Программа выполняется интепретатором.

Алгоритм выполнения запуск-программы
====================================

1. Приходит запрос, сопровождаемый а) именем команды и б) перечнем дополнительных параметров запроса.
2. Запрос по очереди передается компонентам программы.
3. При поступлении запроса в компоненту, этот запрос передается первому шагу этой компоненты.
4. Шаг определяет реакцию на команду, и в его семантике происходит решение, следует ли передавать запрос
следующему шагу данной компоненты, и какой это будет запрос (этот же самый, или какой-то другой).
5. В конце концов обработка запроса в данной компоненте прекращается, и запрос передается следующей
компоненте программы.

Вышеописанный процесс сопровождается расчетом параметров по следующему алгоритму.
1. Программа имеет список собственных параметров. При поступлении запроса, этот список 
объединеятся со списком параметров запроса (параметры запроса имеют приоритет выше).
2. Компоненты своих параметров не имеют.
3. Каждый шаг имеет свои параметры. В значениях этих параметров могут быть формулы, 
включающие ссылки на другие параметры этого шага, а также ссылки на текущие параметры программы.
При выполнении шага, все формулы для его личных параметров - вычисляются.

У каждого шага есть тип. Если тип известен интерпретатору, он реагирует на него сам.
Если тип шага интерпретатору неизвестен, то считается что этот тип шага является идентификатором внешней 
запуск-программы, и производится её поиск и выполнение. При этом параметры этого шага становятся
параметрами запроса к запускаемой запуск-программе.

## Учет имен

Интерпретатор отслеживает развитие пространства имен. При запуске подпрограммы, интерпретатор
назначает ей префикс имени, связанный с конкретным путем программ и компонент, вызвавших эту программу.
Таким образом, каждый экземпляр запускаемой подпрограммы имеет вполне конкретный символьный
идентификатор, уникальный во всём вычислении, и может его использовать по своему усмотрению.

## Отслеживание состояния

Интерпретатор ведет учет применяемых компонент, и код, ассоциированный с конкретной компонентой,
имеет локальное (по отношению к этой компоненте) хранилище данных.

## Особенности выполнения

Интерпретор предоставляет шагам возможность при необходимости останавливать выполенние всей запуск-программы.

Синтаксис
=========
Запуск-программа это каталог вида `имя.zdb`, содержащий 1 или более файлов расширением `ini`.
Каталог может содержать и другие файлы и подкаталоги, для интерпретатора это значение не имеет.
Интерпретатор упорядочивает и считывает все файлы *.ini, находящиеся на первом уровне каталога
программы, объединяет их в общее содержимое, и обрабатывает.

Синтаксис содержимого - это набор `компонент`, обозначаемых заголовками в формате 
`###### component-name ######` (требуется не менее 3х символов `#`), 
и далее у каждой компоненты перечень её шагов в формате ini.

Пример:
```
################## params #####################
alfa=5
beta=8

################## comp1 ######################
[info]
apply=Performing deeds with alfa={{alfa}}

[os]
apply=echo {{alfa}} > {{beta}}.conf
destroy=rm -f {{beta}}.conf

################## comp2 ######################
[os]
apply=/etc/init.d/nginx start
restart=/etc/init.d/nginx restart
```

Здесь:
* `######### params ########` это обозначение раздела, задающего параметры программы.
* alfa, beta - параметры прораммы
* `##### comp1 #####`, `####### comp2 ######` - компоненты и их идентификаторы (требуется не менее 3х символов `#`).
* `[info]` и `[os]` - шаги, принадлежащие компоненте comp1.
* apply, destroy, restart - параметры шагов.
* вставки вида {{name}} это подстановка значений параметров.

Вышеуказанная программа содержит 2 компоненты (comp1 и comp2) и описание своих параметров.
Компонента comp1 содержит 2 шага - `[info]` и `[os]`. Компонента comp2 содержит 1 шаг - только `[os]`.

Выполнение данной программы с командой apply повлечет 3 ее действия:
1. Печать на экран сообщения **Performing deeds with alfa=5**
2. Выполнение команды **echo 5 > 8.conf**.
3. Выполнение команды **/etc/init.d/nginx start**

Выполнение данной программы с командой restart повлечет 1 действие:
1. Выполнение команды **/etc/init.d/nginx restart**

